#!/bin/sh

PROGNAME=${0##*/}
PROGVERSION="0.0.1"

source ~/.bash/shutils.conf

_commmand_help(){
	echo -e "$@"
	echo
	cat << EOF

USAGE:
Usage $PROGNAME [OPTIONS] COMMAND options....

Available COMMAND:
	update ....................... Update the current machine
	reload ....................... Re-source dotfiles in the current shell
	ignite <profile> ............. Setup a new machine using profile
	gterm <sub-cmd> .............. Manipulate gnome terminal configuration
	cheat <sub-cmd> .............. Manipulate cheat files
	byobu <sub-cmd> .............. Manipulate byobu configuration
	xcd .......................... Add xcd shortcuts

OPTIONS:
	-h | --help .................. Display this message
	-v | --verbose ............... Display debug output

EOF
exit 1
}

_command_list(){ # List all available commands
	# get all _command definitions
	# add spaces at the beginning for better display
	# strip unnecessary characters
	# tabulate
	grep -E '^_command_.*\{.*#' $0  \
	| sed 's/\(^.\)/    \1/g' \
	| sed 's/_command_\|[(){}]//g' \
	| column -s'#' -t
	echo
}

_command_update() {
	verbose $FUNCNAME: $*
}
_command_reload() {
	verbose $FUNCNAME: $*
}
_command_ignite() {
	verbose $FUNCNAME: $*
}
_command_gterm() {
	verbose $FUNCNAME: $*
}
_command_cheat() {
	verbose $FUNCNAME: $*
}
_command_byobu() {
	verbose $FUNCNAME: $*
}
_command_xcd() {
	verbose $FUNCNAME: $*
}
#Parsing arguments ###################
set_option_defaults() {
	VERBOSE="no"
}

set_option_defaults
SHORTOPTS="hvV"
LONGOPTS="help,verbose,version"

ARGS=$(getopt -s bash --options $SHORTOPTS  \
	--longoptions $LONGOPTS --name $PROGNAME -- "$@" )

eval set -- "$ARGS"
while true; do
	case $1 in
		-h|--help) _commmand_help;;
		-v|--verbose) VERBOSE="yes";;
		-V|--version) echo "$PROGVERSION"; exit 0 ;;
		--)	shift; break;;
		*) shift; break	;;
	esac
	shift
done

[ -z "$1" ] && COMMAND="$1"
shift && OPTIONS="${@}"

_command_${COMMAND} ${SUB_CMD} ${OPTIONS} 2>/dev/null || \
	failure "command not found! try --help"


exit 0
# vim: cc=80 tw=100 sw=4 ts=4:
