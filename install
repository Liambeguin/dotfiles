#!/bin/sh

DISTRO="$(cat /etc/system-release)"
PM_install="sudo dnf install -y -q"
dotfiles_home="$(dirname $0)"
dotfiles_home="$(realpath $dotfiles_home)"
VERBOSE="no"

verbose "Current system release is : $DISTRO"

# installing a few bash functions I often use
mkdir -p ${HOME}/bin
ln -sf $(pwd)/bash/base_functions.conf ${HOME}/bin/
source ./bash/base_functions.conf

# this is because the package manager
if [ -z "$(echo $DISTRO | grep -i fedora)" ]; then
	exit_err "For now, the only Linux distro supported is Fedora... Sorry !"
fi
# If we are on an older Fedora release use YUM instead of DNF
if [ -z "$(which dnf)" ]; then
	PM="sudo yum install -y -q"
fi

if [ $(whoami) = "root" ]; then
	exit_err "This must NOT be run as root !"
fi

if [ -z "$(groups | grep wheel)" ]; then
	exit_err "$(whoami) is not in wheel group try : 'sudo usermod -aG wheel $(whoami)'"
fi

# Warn the user this is dangerous
read -p "This will delete all your old rcfiles and install packages Continue ? [y/n] " rc
if [ $rc != "y" ]; then
	exit_err "Exiting upon your request !"
fi

# install needed packages
#TODO add build essential
verbose "installing screen, vim and git..."
$PM_install screen vim git
verbose "Done"

# link custom dotfiles
ln -sf $(pwd)/bashrc ${HOME}/.bashrc
ln -sf $(pwd)/screenrc ${HOME}/.screenrc
# Setting up vim
ln -sf $(pwd)/vimrc ${HOME}/.vimrc
git clone https://github.com/gmarik/Vundle.vim.git ${HOME}/.vim/bundle/Vundle.vim


# setup gnome-terminal
verbose "Installing fonts ..."
$PM_install terminus-fonts terminus-fonts-console
verbose "Editing gnome-terminal settings..."
dconf load /org/gnome/terminal/legacy/ < $dotfiles_home/terminal_settings
verbose "Done"

# vim:set cc=80 :
